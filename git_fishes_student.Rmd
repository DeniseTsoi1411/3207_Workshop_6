---
title: "Git, GitHub & Ocean Acidification"
author: "<Wing Tung Tsoi u7079953>"
date: "`r Sys.Date()`"
output: 
  bookdown::html_document2:
    code_folding: show
    number_sections: no
    toc: yes
    toc_depth: 6
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(digits=2)
```

# **Installing packages**

This project focuses on utilising techniques such as data visualisation, data wrangling and NHST to analyse a data set on ocean acidification effects on fish behaviour.

```{r loadpacks, message=FALSE, results='hide'}

install.packages("pacman", repos = "http://cran.us.r-project.org") #p_load from 'pacman' package allows to seamlessly install many packages at once
library(pacman)

p_load(bookdown, tidyverse, ggforce, flextable, latex2exp, png, magick) # executes both 'install.packages' and library command

```


# **Establishing the path and working directory**

```{r, loaddata, eval = FALSE, echo=TRUE}

path <- "./Files/OA_activitydat_20190302_BIOL3207.csv"
  
data <- read_csv(path)

```
# **Saving the path name and data together **

```{r, write, eval = FALSE, echo=TRUE}

path <- "C:/Users/Denise Tsoi/OneDrive/Documents/GitHub/3207_Workshop_6"

write_csv(data, file = path)

```


# **Data Wrangling**

```{r, rmMiss}
# Omitting missing data
data <- na.omit(data)
```

```{r summaryTab}
# Drop irrelevant columns ('...1' and 'comment')
data_n <- subset(data, select = -c(...1, comment))

# Checking the values within the 'animal_id' column
table(data_n$animal_id) #Found that there are some repeated animal IDs (Not unique)
unique <- data_n[!duplicated(data_n[,"animal_id"]),] #Kept unique values
unique_g <- unique %>% group_by(species, treatment) %>% summarise(mean=mean(activity), 
                                                      n = length(activity), 
                                                      se = sd(activity) / sqrt(n))
# Shows numerical information of unique fishes across all six fish species for each treatment

data_g <- data_n %>% group_by(species, treatment) %>% summarise(mean = mean(activity), 
                                                      n = length(activity), 
                                                      se = sd(activity) / sqrt(n))
# Numerical information of animals excluding animal IDs

# Use 'flextable' to render the summary table in a tidy format

library(flextable)

flex_data <- add_footer_lines(flextable(data_g), "Numeric information for all species")
dlex_unique <- add_footer_lines(flextable(unique_g), "Numeric information for unique species")
```

# **Data Visualisation**

```{r, figure1, fig.align='center', fig.cap="Figure 1: Mean activity of species and treatment"}
# ggplot figure showing mean activity for each treatment (Control, OA) for each species.
library(ggplot2)
ggplot(data_g, aes(y = mean, x = species)) + geom_point(aes(colour = treatment)) + labs(title = "Mean activity of each species depending on the treatment", x = "Species", y = "Mean activity")

```

```{r, savefig}
# Use ggsave to save the figure
library(png)

ggplot(data_g, aes(y = mean, x = species)) + geom_point(aes(colour = treatment)) + 
  labs(title = "Mean activity of each species depending on the treatment", x = "Species", y = "Mean activity") +
  annotation_raster(raster1, 0.5,1.5,40,35) +
  annotation_raster(as.raster(readPNG("./Files/pics/ambon.png")), 1.5,2.5,40,35) +
  annotation_raster(as.raster(readPNG("./Files/pics/chromis.png")), 2.5,3.5, 40,35) +
  annotation_raster(as.raster(readPNG("./Files/pics/humbug.png")), 3.5,4.5, 40,35) +
  annotation_raster(as.raster(readPNG("./Files/pics/lemon.png")), 4.5,5.5,40,35) +
  annotation_raster(as.raster(readPNG("./Files/pics/whitedams.png")),5.5, 6.5, 40,35)

ggsave("./Files/Output/Figures/raster_plot.png", width = 6, height = 8)
```

# ** Statistical testing: 95% Confidence interval, t-statistics, df and p-value **

```{r, stats, echo=TRUE, eval=TRUE}
# Analysing the mean and standard deviation to determine direction of statistical analysis
  # CO2 treatment analysis
treat <- data_n[which(data_n$treatment == "CO2"),] %>% subset(select = -c(loc, animal_id, sl, size))
mean(treat$activity) #29
sd(treat$activity) # 13

  # Control analysis
control <- data_n[which(data_n$treatment == "control"),] %>% subset(select = -c(loc, animal_id, sl, size))
mean(control$activity) # 28
sd(control$activity) # 13
  # Because both groups have the same standard deviation and very similar mean values, we can utilise the 2 sample t test

### METHOD 1: Doing t test to each species individually
ancantho <- data_n[which(data_n$species == "acantho"),] %>% subset(select = -c(loc, animal_id, sl, size))
ambon <- data_n[which(data_n$species == "ambon"),] %>% subset(select = -c(loc, animal_id, sl, size))
lemon <- data_n[which(data_n$species == "lemon"),] %>% subset(select = -c(loc, animal_id, sl, size))
chromis <- data_n[which(data_n$species == "chromis"),] %>% subset(select = -c(loc, animal_id, sl, size))
humbug <- data_n[which(data_n$species == "humbug"),] %>% subset(select = -c(loc, animal_id, sl, size))
whitedams <- data_n[which(data_n$species == "whitedams"),] %>% subset(select = -c(loc, animal_id, sl, size))

test_ancantho <- t.test(ancantho$activity ~ ancantho$treatment, var.equal = T)
test_ancantho <- test_ancantho[c(1:5)]
  # Difference in mean = 2
  # 95% confidence interval = -4.9 to 1.6
  # t statistic = -1
  # df = 174
  # p-value = 0.3
test_ambon <- t.test(ambon$activity ~ ambon$treatment, var.equal = T)
test_ambon <- test_ambon[c(1:5)]
  # Difference in mean = 1
  # 95% confidence interval = -6.2 to 8.3
  # t statistic = 0.3
  # df = 41
  # p-value = 0.8
test_lemon <- t.test(lemon$activity ~ lemon$treatment, var.equal = T)
test_lemon <- test_lemon[c(1:5)]
  # Difference in mean = 6
  # 95% confidence interval = -0.7 to 13.2
  # t statistic = 2
  # df = 47
  # p-value = 0.08
test_chromis <- t.test(chromis$activity ~ chromis$treatment, var.equal = T)
test_chromis <- ttest_chromis[c(1:5)]
  # Difference in mean = 1
  # 95% confidence interval = -8.4 to 5.7
  # t statistic = -0.4
  # df = 32
  # p-value = 0.7
test_humbug <- t.test(humbug$activity ~ humbug$treatment, var.equal = T)
test_humbug <- test_humbug[c(1:5)]
  # Difference in mean = 5
  # 95% confidence interval = 0.82 to 9.92
  # t statistic = 2
  # df = 125
  # p-value = 0.02
test_whitedams <- t.test(whitedams$activity ~ whitedams$treatment, var.equal = T) 
test_whitedams <- test_whitedams[c(1:5)]
tibble(test_whitedams = list()) %>% 
   unnest_wider(test_whitedams, names_sep = "")
]\
 # subset(select = c("statistic", "parameter", "p.value", "conf.int", "estimate"))
  # Difference in mean = 3
  # 95% confidence interval = -5.9 to 1.6
  # t statistic = -1
  # df = 119
  # p-value = 0.3

### METHOD 2: Tried to do via ANOVA (Did not work)
mod1 <- group_by(species) %>% (lm(activity ~ treatment * species, data = data_n)
summary(mod1)

  # Ancantho is the base level (Hence the first couple 'species' line shows the difference in means of that species compared to base level(Ancantho) when the treatment is held constant)
```

```{r, table1, echo=TRUE, eval=TRUE, tab.cap = "T statistic summary of difference in treatment on the species"}
final_table <- 
  list(test_whitedams)
```
